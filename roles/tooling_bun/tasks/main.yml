---
- name: Ensure curl is present (Linux)
  ansible.builtin.package:
    name: curl
    state: present
  become: true
  when:
    - tooling_bun_enabled
    - ansible_facts['os_family'] in ['Debian', 'RedHat']

- name: Check if bun is already installed
  ansible.builtin.command: bun --version
  register: tooling_bun_version
  changed_when: false
  failed_when: false
  when: tooling_bun_enabled

- name: Download bun installer
  ansible.builtin.get_url:
    url: https://bun.sh/install
    dest: /tmp/bun-install.sh
    mode: "0755"
  when:
    - tooling_bun_enabled
    - tooling_bun_version.rc != 0

- name: Install bun (user-local)
  ansible.builtin.command: /tmp/bun-install.sh
  args:
    creates: "{{ ansible_facts['env']['HOME'] }}/.bun/bin/bun"
  when:
    - tooling_bun_enabled
    - tooling_bun_version.rc != 0
